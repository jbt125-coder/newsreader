<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>World News Reader</title>

<style>
body{
    font-family:-apple-system,BlinkMacSystemFont,sans-serif;
    padding:15px;
    margin:0;
    transition: background 0.3s, color 0.3s;
}
body.light{
    background:#fff;
    color:#111;
}
body.dark{
    background:#111;
    color:white;
}
h1{
    text-align:center;
}
button, select{
    width:100%;
    padding:14px;
    font-size:18px;
    border-radius:12px;
    border:none;
    margin-top:10px;
}
button{
    background:#0a84ff;
    color:white;
}
select{
    background:#222;
    color:white;
}
#status{
    margin-top:15px;
    font-size:14px;
    opacity:0.9;
}
.toggle-theme{
    margin-top:10px;
    background:#555;
    color:white;
}
</style>
</head>

<body class="dark">

<h1>üåç World News Reader</h1>

<!-- Dropdown menu for news sources -->
<select id="newsSource">
    <option value="https://feeds.npr.org/1001/rss.xml">NPR</option>
    <option value="http://feeds.bbci.co.uk/news/rss.xml">BBC News</option>
    <option value="http://feeds.reuters.com/reuters/topNews">Reuters</option>
    <option value="https://www.theverge.com/rss/index.xml">The Verge</option>
</select>

<button onclick="getNews()">Get Top Stories</button>
<button onclick="openSite()">Open News Website</button>
<button class="toggle-theme" onclick="toggleTheme()">Toggle Light/Dark Theme</button>

<div id="status">
Select a source and press <b>Get Top Stories</b> to generate a PDF.
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const { jsPDF } = window.jspdf;

function toggleTheme(){
    const body = document.body;
    if(body.classList.contains('dark')){
        body.classList.remove('dark');
        body.classList.add('light');
    } else {
        body.classList.remove('light');
        body.classList.add('dark');
    }
}

async function getNews(){
    const status = document.getElementById("status");
    status.innerHTML = "Fetching news...";

    try{
        const rssURL = document.getElementById("newsSource").value;

        // Use AllOrigins as CORS proxy
        const response = await fetch(
            "https://api.allorigins.win/get?url=" + encodeURIComponent(rssURL)
        );
        const data = await response.json();

        const xml = new DOMParser().parseFromString(data.contents,"text/xml");
        const items = xml.querySelectorAll("item");

        if(items.length === 0){
            status.innerHTML = "No items found in this feed.";
            return;
        }

        // Create PDF
        const pdf = new jsPDF('p','pt','a4');
        const pageWidth = pdf.internal.pageSize.getWidth();
        const lineHeight = 16;
        const margin = 40;
        let y = margin;
        let pageNum = 1;

        for(let i=0;i<5 && i<items.length;i++){
            const title = items[i].querySelector("title")?.textContent || "No Title";
            const desc = items[i].querySelector("description")?.textContent || "";
            const link = items[i].querySelector("link")?.textContent || "#";
            const pubDate = items[i].querySelector("pubDate")?.textContent || "";

            pdf.setFontSize(16);
            pdf.setFont("helvetica","bold");
            y = addText(pdf,title,margin,y,pageWidth-margin);

            pdf.setFontSize(12);
            pdf.setFont("helvetica","normal");
            y += 5;
            y = addText(pdf,"Published: " + pubDate,margin,y,pageWidth-margin);
            y += 5;
            y = addText(pdf,desc.replace(/<[^>]+>/g, ''),margin,y,pageWidth-margin);
            y += 5;

            // Link (clickable)
            pdf.setTextColor(0,0,255);
            pdf.textWithLink(link, margin, y, {url: link});
            pdf.setTextColor(0,0,0);
            y += 30;

            // Page break if needed
            if(y > pdf.internal.pageSize.getHeight() - 60){
                pdf.text("Page " + pageNum, pageWidth/2, pdf.internal.pageSize.getHeight()-30,{align:'center'});
                pdf.addPage();
                y = margin;
                pageNum++;
            }
        }

        // Add final page number
        pdf.text("Page " + pageNum, pageWidth/2, pdf.internal.pageSize.getHeight()-30,{align:'center'});

        pdf.save("Top_Stories.pdf");
        status.innerHTML = "PDF generated successfully!";
    }
    catch(e){
        status.innerHTML = "Failed to fetch news. Try hosting online or using a different feed.";
        console.error(e);
    }
}

// Helper to wrap text
function addText(pdf,text,x,y,maxWidth){
    const lines = pdf.splitTextToSize(text,maxWidth-x*2);
    pdf.text(lines,x,y);
    return y + lines.length*14;
}

// Map feed URLs to main site
function openSite(){
    const rssURL = document.getElementById("newsSource").value;
    const siteMap = {
        "https://feeds.npr.org/1001/rss.xml":"https://www.npr.org/",
        "http://feeds.bbci.co.uk/news/rss.xml":"https://www.bbc.com/news",
        "http://feeds.reuters.com/reuters/topNews":"https://www.reuters.com/",
        "https://www.theverge.com/rss/index.xml":"https://www.theverge.com/"
    };
    window.open(siteMap[rssURL]||"https://www.npr.org/","_blank");
}
</script>

</body>
</html>
